---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { Star, ExternalLink, Heart, Share2, TrendingDown, Package, Clock } from 'lucide-react';

// Mock product data
const product = {
  id: '1',
  name: 'iPhone 15 Pro 256GB ナチュラルチタン',
  description: 'A17 Proチップ搭載の最新iPhone。5X光学ズームとナチュラルチタンデザイン。',
  price: 148800,
  originalPrice: 159800,
  discount: 11000,
  platform: 'Amazon',
  rating: 4.8,
  reviewCount: 2341,
  images: [
    '/images/products/iphone-15-pro-1.jpg',
    '/images/products/iphone-15-pro-2.jpg',
    '/images/products/iphone-15-pro-3.jpg'
  ],
  category: '家電',
  brand: 'Apple',
  model: 'A3104',
  janCode: '4582422490455',
  specifications: {
    '画面サイズ': '6.1インチ',
    'ストレージ': '256GB',
    'カラー': 'ナチュラルチタン',
    'カメラ': '48MP + 12MP + 12MP',
    'プロセッサ': 'A17 Pro',
    'バッテリー容量': '3274mAh',
    '重量': '187g',
    '寸法': '146.6 x 70.6 x 8.25 mm'
  },
  priceHistory: [
    { date: '2024-01-15', price: 148800, platform: 'Amazon' },
    { date: '2024-01-14', price: 152800, platform: '楽天' },
    { date: '2024-01-13', price: 155800, platform: 'Yahoo!ショッピング' },
    { date: '2024-01-12', price: 158800, platform: 'Amazon' },
    { date: '2024-01-11', price: 159800, platform: '楽天' }
  ],
  retailers: [
    {
      platform: 'Amazon',
      price: 148800,
      url: 'https://amazon.co.jp/dp/B0CHX2XQ1F',
      availability: 'in_stock',
      shipping: {
        cost: 0,
        estimatedDelivery: '2024-01-25'
      },
      lastUpdated: '2024-01-20T10:30:00Z'
    },
    {
      platform: '楽天',
      price: 152800,
      url: 'https://rakuten.co.jp/product/12345',
      availability: 'in_stock',
      shipping: {
        cost: 550,
        estimatedDelivery: '2024-01-26'
      },
      lastUpdated: '2024-01-20T09:15:00Z'
    },
    {
      platform: 'Yahoo!ショッピング',
      price: 149800,
      url: 'https://shopping.yahoo.co.jp/product/67890',
      availability: 'limited',
      shipping: {
        cost: 0,
        estimatedDelivery: '2024-01-24'
      },
      lastUpdated: '2024-01-20T11:45:00Z'
    }
  ],
  availability: 'in_stock',
  url: '/products/iphone-15-pro',
  createdAt: '2024-01-15T10:00:00Z',
  updatedAt: '2024-01-20T14:30:00Z'
};

// Calculate price statistics
const lowestPrice = Math.min(...product.retailers.map(r => r.price));
const highestPrice = Math.max(...product.retailers.map(r => r.price));
const maxSavings = highestPrice - lowestPrice;
---

<BaseLayout
  title={`${product.name} - Yabaii`}
  description={`${product.name}の最安値を比較。${product.retailers.length}店舗の価格をリアルタイムでチェック。現在の最安値は¥${lowestPrice.toLocaleString()}。`}
>
  <div class="container py-8">
    {/* Breadcrumb */}
    <nav class="mb-6 text-sm">
      <ol class="flex items-center space-x-2 text-gray-600">
        <li><a href="/" class="hover:text-blue-600">ホーム</a></li>
        <li><span>/</span></li>
        <li><a href="/search" class="hover:text-blue-600">検索</a></li>
        <li><span>/</span></li>
        <li><a href={`/search?category=${encodeURIComponent(product.category)}`} class="hover:text-blue-600">{product.category}</a></li>
        <li><span>/</span></li>
        <li class="text-gray-900 font-medium">{product.name}</li>
      </ol>
    </nav>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      <!-- Main Content -->
      <main class="lg:col-span-2">
        {/* Product Header */}
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
          <div class="flex flex-col md:flex-row gap-6">
            {/* Product Images */}
            <div class="md:w-1/3">
              <div class="aspect-square bg-gray-200 rounded-lg mb-4">
                <!-- Main image placeholder -->
                <div class="w-full h-full flex items-center justify-center text-gray-400">
                  <svg class="w-16 h-16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                  </svg>
                </div>
              </div>

              {/* Thumbnail Gallery */}
              <div class="grid grid-cols-4 gap-2">
                {product.images.map((image, index) => (
                  <div key={index} class="aspect-square bg-gray-100 rounded cursor-pointer hover:border-blue-500 border-2 border-transparent transition-colors">
                    <div class="w-full h-full flex items-center justify-center text-gray-400">
                      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                      </svg>
                    </div>
                  </div>
                ))}
              </div>
            </div>

            {/* Product Info */}
            <div class="md:w-2/3">
              <div class="mb-4">
                <div class="flex items-start justify-between mb-2">
                  <h1 class="text-2xl font-bold text-gray-900 mb-2">{product.name}</h1>
                  <div class="flex items-center space-x-2">
                    <button class="p-2 text-gray-400 hover:text-red-500 transition-colors" title="お気に入りに追加">
                      <Heart class="w-5 h-5" />
                    </button>
                    <button class="p-2 text-gray-400 hover:text-blue-500 transition-colors" title="共有">
                      <Share2 class="w-5 h-5" />
                    </button>
                  </div>
                </div>

                <div class="flex items-center space-x-4 text-sm text-gray-600 mb-4">
                  <div class="flex items-center">
                    <Star class="w-4 h-4 text-yellow-400 fill-current" />
                    <span class="ml-1 font-semibold">{product.rating}</span>
                    <span class="ml-1">({product.reviewCount.toLocaleString()}件のレビュー)</span>
                  </div>
                  <span>|</span>
                  <span>{product.brand}</span>
                  <span>|</span>
                  <span>JAN: {product.janCode}</span>
                </div>

                <p class="text-gray-600 mb-6">{product.description}</p>
              </div>

              {/* Price Comparison */}
              <div class="bg-blue-50 rounded-lg p-6 mb-6">
                <div class="flex items-center justify-between mb-4">
                  <div>
                    <div class="text-sm text-blue-600 font-medium mb-1">現在の最安値</div>
                    <div class="flex items-baseline space-x-2">
                      <span class="text-3xl font-bold text-blue-600">¥{lowestPrice.toLocaleString()}</span>
                      {product.originalPrice && (
                        <span class="text-gray-400 line-through">¥{product.originalPrice.toLocaleString()}</span>
                      )}
                    </div>
                    <div class="text-green-600 font-semibold text-sm mt-1">
                      最大 ¥{maxSavings.toLocaleString()} お得
                    </div>
                  </div>
                  <div class="text-right">
                    <div class="text-sm text-gray-600 mb-1">価格推移</div>
                    <div class="text-lg font-semibold text-blue-600">↓{Math.round((maxSavings / highestPrice) * 100)}%</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        {/* Price History Chart */}
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
          <h2 class="text-xl font-semibold text-gray-900 mb-4 flex items-center">
            <TrendingDown class="w-5 h-5 mr-2 text-blue-600" />
            価格推移
          </h2>
          <div class="h-64 bg-gray-100 rounded-lg flex items-center justify-center text-gray-500">
            <div class="text-center">
              <svg class="w-12 h-12 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
              </svg>
              <p>価格チャート（実装予定）</p>
            </div>
          </div>
        </div>

        {/* Specifications */}
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
          <h2 class="text-xl font-semibold text-gray-900 mb-4">製品仕様</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            {Object.entries(product.specifications).map(([key, value]) => (
              <div key={key} class="flex justify-between py-2 border-b border-gray-100">
                <span class="text-gray-600">{key}</span>
                <span class="font-medium text-gray-900">{value}</span>
              </div>
            ))}
          </div>
        </div>
      </main>

      {/* Sidebar */}
      <aside class="lg:col-span-1">
        {/* Retailer Comparison */}
        <div class="bg-white rounded-lg shadow-md p-6 sticky top-24">
          <h2 class="text-xl font-semibold text-gray-900 mb-4 flex items-center">
            <Package class="w-5 h-5 mr-2 text-blue-600" />
            販売店比較
          </h2>

          <div class="space-y-4">
            {product.retailers
              .sort((a, b) => a.price - b.price)
              .map((retailer, index) => (
              <div key={retailer.platform} class={`border rounded-lg p-4 ${index === 0 ? 'border-green-500 bg-green-50' : 'border-gray-200'}`}>
                {index === 0 && (
                  <div class="flex items-center text-green-600 text-sm font-semibold mb-2">
                    <span class="w-2 h-2 bg-green-600 rounded-full mr-1"></span>
                    最安値
                  </div>
                )}

                <div class="flex items-start justify-between mb-3">
                  <div>
                    <div class="font-semibold text-gray-900">{retailer.platform}</div>
                    <div class="text-lg font-bold text-red-600">¥{retailer.price.toLocaleString()}</div>
                    {retailer.shipping && (
                      <div class="text-sm text-gray-600">
                        送料: {retailer.shipping.cost === 0 ? '無料' : `¥${retailer.shipping.cost}`}
                      </div>
                    )}
                  </div>
                  <div class={`px-2 py-1 rounded-full text-xs font-medium ${
                    retailer.availability === 'in_stock'
                      ? 'bg-green-100 text-green-800'
                      : retailer.availability === 'limited'
                      ? 'bg-yellow-100 text-yellow-800'
                      : 'bg-red-100 text-red-800'
                  }`}>
                    {retailer.availability === 'in_stock' ? '在庫あり' :
                     retailer.availability === 'limited' ? '残りわずか' : '在庫切れ'}
                  </div>
                </div>

                <div class="flex items-center justify-between text-xs text-gray-500 mb-3">
                  <span>最終更新: {new Date(retailer.lastUpdated).toLocaleString('ja-JP')}</span>
                  {retailer.shipping?.estimatedDelivery && (
                    <span class="flex items-center">
                      <Clock class="w-3 h-3 mr-1" />
                      {retailer.shipping.estimatedDelivery} まで
                    </span>
                  )}
                </div>

                <a
                  href={retailer.url}
                  target="_blank"
                  rel="noopener noreferrer"
                  class={`w-full inline-flex items-center justify-center px-4 py-2 rounded-md text-sm font-medium transition-colors ${
                    index === 0
                      ? 'bg-blue-600 text-white hover:bg-blue-700'
                      : 'border border-gray-300 text-gray-700 hover:bg-gray-50'
                  }`}
                >
                  {retailer.platform}で見る
                  <ExternalLink class="w-4 h-4 ml-1" />
                </a>
              </div>
            ))}
          </div>
        </div>
      </aside>
    </div>
  </div>
</BaseLayout>
