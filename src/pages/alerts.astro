---
import BaseLayout from '../layouts/BaseLayout.astro';
import { Bell, Plus, X, TrendingDown, Package } from 'lucide-react';

// Mock alerts data
const userAlerts = [
  {
    id: '1',
    productName: 'iPhone 15 Pro 256GB',
    targetPrice: 130000,
    currentPrice: 148800,
    threshold: 10,
    type: 'price_drop',
    isActive: true,
    createdAt: '2024-01-15T10:00:00Z',
    lastTriggered: '2024-01-20T14:30:00Z',
    image: '/images/products/iphone-15-pro.jpg',
    url: '/products/1'
  },
  {
    id: '2',
    productName: 'Sony WH-1000XM5',
    targetPrice: 35000,
    currentPrice: 42900,
    threshold: 15,
    type: 'target_price',
    isActive: true,
    createdAt: '2024-01-10T09:15:00Z',
    image: '/images/products/sony-headphones.jpg',
    url: '/products/2'
  }
];

const recentAlerts = [
  {
    id: '1',
    productName: 'Nintendo Switch OLED',
    alertType: 'price_drop',
    oldPrice: 37980,
    newPrice: 32980,
    savings: 5000,
    timestamp: '2024-01-20T15:30:00Z',
    message: '価格が5,000円下がりました！'
  },
  {
    id: '2',
    productName: 'AirPods Pro 2',
    alertType: 'back_in_stock',
    timestamp: '2024-01-20T12:15:00Z',
    message: '在庫が復活しました！'
  }
];

const alertTemplates = [
  {
    type: 'price_drop',
    name: '価格下落アラート',
    description: '製品価格が指定した金額以下になったら通知',
    icon: TrendingDown,
    color: 'green'
  },
  {
    type: 'back_in_stock',
    name: '再入荷アラート',
    description: '在庫切れの製品が再入荷したら通知',
    icon: Package,
    color: 'blue'
  },
  {
    type: 'target_price',
    name: '目標価格アラート',
    description: '製品価格が目標価格に達したら通知',
    icon: Bell,
    color: 'purple'
  }
];
---

<BaseLayout
  title="価格アラート - Yabaii"
  description="製品の価格下落、再入荷、目標価格を設定して通知を受け取りましょう。お得な買い物のチャンスを見逃しません。"
>
  <div class="container py-8">
    {/* Header */}
    <div class="text-center mb-10">
      <div class="flex items-center justify-center mb-4">
        <Bell class="w-8 h-8 text-blue-600 mr-2" />
        <h1 class="text-4xl font-bold text-gray-900">価格アラート</h1>
      </div>
      <p class="text-xl text-gray-600 max-w-3xl mx-auto">
        気になる製品の価格を監視して、お得なタイミングを見逃しません。
        価格下落、再入荷、目標価格達成時に通知を受け取れます。
      </p>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      {/* Sidebar - Alert Creation */}
      <aside class="lg:col-span-1">
        <div class="bg-white rounded-lg shadow-md p-6 sticky top-24">
          <h2 class="text-xl font-semibold text-gray-900 mb-6">新しいアラート作成</h2>

          {/* Alert Types */}
          <div class="space-y-4 mb-6">
            {alertTemplates.map((template) => (
              <div key={template.type} class="border border-gray-200 rounded-lg p-4 hover:border-blue-300 hover:bg-blue-50 transition-colors cursor-pointer">
                <div class="flex items-start space-x-3">
                  <div class={`p-2 rounded-lg bg-${template.color}-100`}>
                    <template.icon class={`w-5 h-5 text-${template.color}-600`} />
                  </div>
                  <div class="flex-1">
                    <h3 class="font-semibold text-gray-900 mb-1">{template.name}</h3>
                    <p class="text-sm text-gray-600">{template.description}</p>
                  </div>
                </div>
              </div>
            ))}
          </div>

          {/* Quick Add Form */}
          <div class="bg-gray-50 rounded-lg p-4">
            <h3 class="font-semibold text-gray-900 mb-3">クイック追加</h3>
            <div class="space-y-3">
              <input
                type="text"
                placeholder="製品名またはJANコード"
                class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
              />
              <div class="flex space-x-2">
                <input
                  type="number"
                  placeholder="目標価格 (任意)"
                  class="flex-1 px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                />
                <select class="px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                  <option value="10">10%下落</option>
                  <option value="20">20%下落</option>
                  <option value="30">30%下落</option>
                </select>
              </div>
              <button class="w-full px-4 py-2 bg-blue-600 text-white font-medium rounded-md hover:bg-blue-700 transition-colors flex items-center justify-center">
                <Plus class="w-4 h-4 mr-2" />
                アラート作成
              </button>
            </div>
          </div>
        </div>
      </aside>

      {/* Main Content */}
      <main class="lg:col-span-2">
        {/* Current Alerts */}
        <section class="mb-10">
          <div class="flex items-center justify-between mb-6">
            <h2 class="text-2xl font-bold text-gray-900">
              現在のアラート ({userAlerts.length})
            </h2>
            <div class="flex space-x-2">
              <button class="px-4 py-2 text-sm border border-gray-300 rounded-md hover:bg-gray-50 transition-colors">
                一括編集
              </button>
              <button class="px-4 py-2 text-sm bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors">
                アラート追加
              </button>
            </div>
          </div>

          {userAlerts.length > 0 ? (
            <div class="space-y-4">
              {userAlerts.map((alert) => (
                <div key={alert.id} class="bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow">
                  <div class="flex items-start justify-between">
                    <div class="flex items-start space-x-4 flex-1">
                      {/* Product Image */}
                      <div class="w-16 h-16 bg-gray-200 rounded-lg flex-shrink-0"></div>

                      {/* Alert Details */}
                      <div class="flex-1">
                        <div class="flex items-start justify-between mb-2">
                          <div>
                            <h3 class="font-semibold text-gray-900 mb-1">{alert.productName}</h3>
                            <div class="flex items-center space-x-4 text-sm text-gray-600">
                              <span class="flex items-center">
                                <TrendingDown class="w-4 h-4 mr-1" />
                                {alert.type === 'price_drop' ? `${alert.threshold}%下落で通知` :
                                 alert.type === 'target_price' ? `目標価格: ¥${alert.targetPrice.toLocaleString()}` :
                                 '再入荷で通知'}
                              </span>
                              <span class="flex items-center">
                                現在価格: <span class="font-semibold text-red-600 ml-1">¥{alert.currentPrice.toLocaleString()}</span>
                              </span>
                            </div>
                          </div>

                          {/* Status Toggle */}
                          <div class="flex items-center space-x-2">
                            <button class="relative inline-flex h-6 w-11 items-center rounded-full bg-blue-600">
                              <span class="translate-x-6 inline-block h-4 w-4 transform rounded-full bg-white transition"></span>
                            </button>
                            <span class="text-xs text-gray-500">ON</span>
                          </div>
                        </div>

                        {/* Progress Bar */}
                        {alert.type === 'target_price' && (
                          <div class="mb-3">
                            <div class="flex justify-between text-xs text-gray-600 mb-1">
                              <span>目標価格: ¥{alert.targetPrice.toLocaleString()}</span>
                              <span className={`font-semibold ${alert.currentPrice <= alert.targetPrice ? 'text-green-600' : 'text-gray-900'}`}>
                                現在: ¥{alert.currentPrice.toLocaleString()}
                              </span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                              <div
                                class="bg-green-600 h-2 rounded-full transition-all duration-300"
                                style={`width: ${Math.max(0, Math.min(100, ((alert.currentPrice - alert.targetPrice) / alert.currentPrice) * 100))}%`}
                              ></div>
                            </div>
                          </div>
                        )}

                        {/* Metadata */}
                        <div class="flex items-center justify-between text-xs text-gray-500">
                          <span>作成日: {new Date(alert.createdAt).toLocaleDateString('ja-JP')}</span>
                          {alert.lastTriggered && (
                            <span>最終通知: {new Date(alert.lastTriggered).toLocaleDateString('ja-JP')}</span>
                          )}
                        </div>
                      </div>
                    </div>

                    {/* Actions */}
                    <div class="flex items-center space-x-2 ml-4">
                      <button class="p-2 text-gray-400 hover:text-gray-600 transition-colors" title="編集">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                        </svg>
                      </button>
                      <button class="p-2 text-gray-400 hover:text-red-600 transition-colors" title="削除">
                        <X class="w-4 h-4" />
                      </button>
                    </div>
                  </div>
                </div>
              ))}
            </div>
          ) : (
            /* Empty State */
            <div class="bg-white rounded-lg shadow-md p-12 text-center">
              <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <Bell class="w-8 h-8 text-gray-400" />
              </div>
              <h3 class="text-lg font-semibold text-gray-900 mb-2">アラートがありません</h3>
              <p class="text-gray-600 mb-6">
                価格アラートを作成して、お得な買い物のチャンスを見逃しません
              </p>
              <button class="px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors flex items-center mx-auto">
                <Plus class="w-4 h-4 mr-2" />
                最初のアラートを作成
              </button>
            </div>
          )}
        </section>

        {/* Recent Notifications */}
        <section>
          <h2 class="text-2xl font-bold text-gray-900 mb-6">最近の通知</h2>

          {recentAlerts.length > 0 ? (
            <div class="space-y-4">
              {recentAlerts.map((notification) => (
                <div key={notification.id} class="bg-white rounded-lg shadow-md p-6 border-l-4 border-green-500">
                  <div class="flex items-start justify-between">
                    <div class="flex items-start space-x-3">
                      <div class="p-2 bg-green-100 rounded-lg">
                        {notification.alertType === 'price_drop' ? (
                          <TrendingDown class="w-5 h-5 text-green-600" />
                        ) : (
                          <Package class="w-5 h-5 text-blue-600" />
                        )}
                      </div>
                      <div>
                        <h3 class="font-semibold text-gray-900 mb-1">{notification.productName}</h3>
                        <p class="text-gray-600 mb-2">{notification.message}</p>
                        {notification.alertType === 'price_drop' && (
                          <div class="flex items-center space-x-2 text-sm">
                            <span class="text-gray-400 line-through">¥{notification.oldPrice.toLocaleString()}</span>
                            <span class="font-semibold text-green-600">¥{notification.newPrice.toLocaleString()}</span>
                            <span class="text-green-600 font-semibold">¥{notification.savings.toLocaleString()} お得</span>
                          </div>
                        )}
                        <div class="text-xs text-gray-500 mt-2">
                          {new Date(notification.timestamp).toLocaleString('ja-JP')}
                        </div>
                      </div>
                    </div>

                    <button class="px-4 py-2 bg-blue-600 text-white text-sm rounded-md hover:bg-blue-700 transition-colors">
                      製品を見る
                    </button>
                  </div>
                </div>
              ))}
            </div>
          ) : (
            <div class="bg-white rounded-lg shadow-md p-8 text-center">
              <div class="w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-3">
                <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4" />
                </svg>
              </div>
              <h3 class="font-semibold text-gray-900 mb-1">新しい通知はありません</h3>
              <p class="text-gray-600 text-sm">
                アラートがトリガーされるとここに表示されます
              </p>
            </div>
          )}
        </section>
      </main>
    </div>
  </div>
</BaseLayout>
